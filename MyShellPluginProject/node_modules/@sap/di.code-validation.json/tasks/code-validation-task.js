'use strict';
var path = require('path');
module.exports = function(grunt) {
    grunt.registerTask('di.code-validation.json', function () {
        grunt.loadNpmTasks('grunt-mkdir');
        grunt.loadNpmTasks('di.code-validation.grunt');

        var pkg = grunt.file.readJSON('package.json');
        var root = pkg.name;
        var tmpDir = path.join('tmp-lint');

        grunt.config("mkdir", {
            tmpDir: {
                options: {
                    create: [tmpDir]
                }
            }
        });

        grunt.config("codevalidation", {
            "di.code-validation.json": {
                options: {
                    projectPath: process.cwd(),
                    pathPrefix: path.join(path.sep, root),
                    ignoredPaths: ['node_modules', tmpDir],
                    reporter: "problems_reporter",
                    reporterOptions: {outputFile: path.join(tmpDir, "di.code-validation.json_issues.json")},
                    validators: {
                        "di.code-validation.json": {
                            extensions: [".json"]
                        }
                    }
                }
            }
        });

        grunt.task.run(['mkdir:tmpDir', 'codevalidation:di.code-validation.json']);

    });
};
