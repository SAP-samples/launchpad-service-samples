'use strict';

var deepmerge = require('deepmerge');
var sessionExt = require('../utils/session-ext');

module.exports = function cacheRequestData (req, res, next) {

  if (!req.toBeCachedOnSession || !req.toBeCachedOnSession.user) {
    return next ();
  }
  if (req.session && req.session.user) {
    sessionExt.update(req.session, function(session) {
      session.user = deepmerge (session.user, req.toBeCachedOnSession.user);
    });
  }

  delete req.toBeCachedOnSession;
  next ();
};